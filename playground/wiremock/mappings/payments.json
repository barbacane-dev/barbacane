{
  "mappings": [
    {
      "name": "Get Payment Status",
      "request": {
        "method": "GET",
        "urlPathPattern": "/api/v3/bookings/.*/payment"
      },
      "response": {
        "status": 200,
        "headers": { "Content-Type": "application/json" },
        "jsonBody": {
          "id": "a7b8c9d0-e1f2-3a4b-5c6d-7e8f9a0b1c2d",
          "booking_id": "d4e5f6a7-b8c9-0d1e-2f3a-4b5c6d7e8f9a",
          "amount": 89.90,
          "currency": "EUR",
          "status": "succeeded",
          "method": "card",
          "requires_action": false,
          "created_at": "2025-02-01T10:35:00Z"
        }
      }
    },
    {
      "name": "Create Payment - Success",
      "request": {
        "method": "POST",
        "urlPathPattern": "/api/v3/bookings/.*/payment",
        "headers": {
          "Content-Type": { "equalTo": "application/json" }
        },
        "bodyPatterns": [
          { "matchesJsonPath": "$.method.type" }
        ]
      },
      "response": {
        "status": 200,
        "headers": { "Content-Type": "application/json" },
        "jsonBody": {
          "id": "{{randomValue type='UUID'}}",
          "booking_id": "d4e5f6a7-b8c9-0d1e-2f3a-4b5c6d7e8f9a",
          "amount": 89.90,
          "currency": "EUR",
          "status": "succeeded",
          "method": "card",
          "requires_action": false,
          "created_at": "{{now format='yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\''}}"
        },
        "transformers": ["response-template"]
      }
    },
    {
      "name": "Create Payment - Requires 3DS",
      "request": {
        "method": "POST",
        "urlPathPattern": "/api/v3/bookings/.*/payment",
        "headers": {
          "X-Simulate-3DS": { "equalTo": "true" }
        }
      },
      "response": {
        "status": 200,
        "headers": { "Content-Type": "application/json" },
        "jsonBody": {
          "id": "{{randomValue type='UUID'}}",
          "booking_id": "d4e5f6a7-b8c9-0d1e-2f3a-4b5c6d7e8f9a",
          "amount": 89.90,
          "currency": "EUR",
          "status": "requires_action",
          "method": "card",
          "requires_action": true,
          "action_url": "https://example.com/3ds-challenge?session={{randomValue type='UUID'}}",
          "created_at": "{{now format='yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\''}}"
        },
        "transformers": ["response-template"]
      },
      "priority": 1
    },
    {
      "name": "Create Payment - Failed",
      "request": {
        "method": "POST",
        "urlPathPattern": "/api/v3/bookings/.*/payment",
        "headers": {
          "X-Simulate-Failure": { "equalTo": "true" }
        }
      },
      "response": {
        "status": 402,
        "headers": { "Content-Type": "application/problem+json" },
        "jsonBody": {
          "code": "PAYMENT_DECLINED",
          "message": "Payment was declined by the card issuer",
          "details": {
            "decline_code": "insufficient_funds",
            "decline_message": "Your card has insufficient funds"
          },
          "documentation_url": "https://docs.trains.example.com/errors#PAYMENT_DECLINED"
        }
      },
      "priority": 1
    }
  ]
}
